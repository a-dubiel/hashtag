function handle_before(){in_progress++}function handle_complete(t){in_progress--,0||($loading.hide(),$load_more.html("Pokaż więcej"),display_posts(t))}var current_posts=[],new_posts=[],old_posts=[],ajax_connections=0,$load_more=$(".load-more"),board={data:"",config:""},$container=$("#posts"),min_tag_id,next_max_id,twitter_max_id,twitter_new_max_id,$count=parseInt($(".check-new").find("span").text()),$loading=$(".board-loading"),in_progress=0,google_next,get_google_posts=function(){$.ajax({url:base+"/api/google/"+hashtag,type:"GET",beforeSend:handle_before,async:!1,success:function(t,e,o){current_posts.push(t.posts),google_next=t.token,handle_complete(current_posts),current_posts=[]},error:function(t){handle_complete(current_posts)}})},get_old_google_posts=function(){$.ajax({url:base+"/api/google/"+hashtag+"/"+google_next,type:"GET",beforeSend:handle_before,async:!1,success:function(t,e,o){console.log(t.posts),current_posts.push(t.posts),google_next=t.token,handle_complete(current_posts),current_posts=[]},error:function(t){handle_complete(current_posts)}})},get_instagram_posts=function(){$.ajax({url:base+"/api/instagram/"+hashtag,type:"GET",beforeSend:handle_before,async:!1,success:function(t,e,o){next_max_id=t.next_max_id,min_tag_id=t.min_tag_id,current_posts.push(t.posts),handle_complete(current_posts),current_posts=[]},error:function(t){handle_complete(current_posts)}})},get_old_instagram_posts=function(){$.ajax({url:base+"/api/instagram/"+hashtag+"/"+next_max_id,type:"GET",async:!1,beforeSend:handle_before,success:function(t,e,o){""==!t.next_max_id&&(next_max_id=t.next_max_id,old_posts.push(t.posts),handle_complete(old_posts),old_posts=[])},error:function(t){handle_complete(old_post)}})},get_twitter_posts=function(){$.ajax({url:base+"/api/twitter/"+hashtag,type:"GET",beforeSend:handle_before,async:!1,success:function(t,e,o){current_posts.push(t.posts),twitter_max_id=t.max_id,twitter_new_max_id=t.new_id,handle_complete(current_posts),console.log(t),current_posts=[]},error:function(t){handle_complete(current_posts)}})},get_old_twitter_posts=function(){$.ajax({url:base+"/api/twitter/"+hashtag+"/"+twitter_max_id,type:"GET",beforeSend:handle_before,async:!1,success:function(t,e,o){twitter_max_id!==t.max_id&&(void 0!==t.posts?(old_posts.push(t.posts),twitter_max_id=t.max_id,handle_complete(old_posts),old_posts=[]):handle_complete(old_posts))},error:function(t){handle_complete(old_posts)}})};!function(){$container.isotope({animationEngine:"css",masonry:{columnWidth:270,isFitWidth:!0,gutter:20}}),$.ajax({url:base+"/api/board/"+board_id,type:"GET",success:function(t,e,o){board.data=t.board,board.config=t.config,0==t.config.has_insta&&get_instagram_posts(),0==t.config.has_tw&&get_twitter_posts(),0==t.config.has_google&&get_google_posts(),board_refresh(parseInt(60))},error:function(t){console.log(t)}})}(),$(document).on("click",".load-more",function(t){console.log($load_more),$load_more.html('<i class="fa fa-circle-o-notch fa-spin"></i>'),0==board.config.has_insta&&get_old_instagram_posts(),0==board.config.has_tw&&get_old_twitter_posts(),0==board.config.has_google&&get_old_google_posts(),t.preventDefault()});var prepend_posts=function(t){var e=$(prepare_posts(t));e.imagesLoaded(function(){$container.prepend(e).isotope("prepended",e),$(".check-new").delay(300).addClass("inactive").html("Nowe posty <span>0</span>"),$("abbr.timeago").timeago()})},display_posts=function(t){var e=$(prepare_posts(t));e.imagesLoaded(function(){$container.isotope("insert",e),$("abbr.timeago").timeago()}),t=[]},prepare_posts=function(t){for(var e="",o=0;o<t.length;o++)for(var s=0;s<t[o].length;s++){var n=t[o][s];n.username&&(e+='<div class="post post-'+n.vendor+'">',e+='<div class="filter filter-'+n.vendor+' pull-right"><i class="fa fa-'+n.vendor+'"></i></div>',e+='<div class="user-info pull-left">',e+='<img src="'+n.user_img_url+'" />',"twitter"==n.vendor?e+='<a href="http://www.twitter.com/'+n.username+'" target="_blank">'+n.username+"</a>":"instagram"==n.vendor?e+='<a href="http://www.instagram.com/'+n.username+'" target="_blank">'+n.username+"</a>":"google-plus"==n.vendor&&(e+='<a href="https://plus.google.com/'+n.user_id+'" target="_blank">'+n.username+"</a>"),e+='<p><abbr class="timeago" title="'+n.date_created+'">'+n.date_created+"</abbr></p>",e+='</div><div class="clearfix"></div>',"image"==n.post_type?(e+='<div class="post-img">',e+='<img src="'+n.img_url+'" alt="" />',e+="</div>"):"video"==n.post_type&&(e+='<div class="post-img">',e+='<img src="'+n.img_url+'" alt="" />',e+="</div>"),n.caption&&n.caption.length>0&&(e+='<div class="post-description">',e+="<p>"+n.caption.replace(/#([^\s#]+)/g,'<a class="hashtag" href="'+base+'/$1/szukaj">#$1</a> ')+"</p>",e+="</div>"),e+="</div>")}return e},board_refresh=function(t){$check=$(".check-new"),setInterval(function(){if(0==board.config.has_insta){var t=$.ajax({type:"GET",url:base+"/api/instagram/new/"+hashtag+"/"+min_tag_id,global:!1,async:!1,dataType:"json",success:function(t,e,o){return min_tag_id=t.min_tag_id,t}}).responseText;t.length>0&&($count+=$.parseJSON(t).count,$posts=$.parseJSON(t).posts,new_posts.push($posts))}if(0==board.config.has_tw){var e=$.ajax({type:"GET",url:base+"/api/twitter/new/"+hashtag+"/"+twitter_new_max_id,global:!1,async:!1,dataType:"json",success:function(t,e,o){return t}}).responseText;e.length>0&&twitter_new_max_id!==$.parseJSON(e).max_id&&($count+=$.parseJSON(e).count,$posts=$.parseJSON(e).posts,twitter_new_max_id=$.parseJSON(e).max_id,new_posts.push($posts))}$count>0&&($check.removeClass("inactive"),$check.find("span").text($count),$("title").text("("+$count+") #"+hashtag+" | hashtag.info"))},1e3*t)};$(document).on("click",".check-new",function(t){$(".check-new").html('Dodaje <i class="fa fa-circle-o-notch fa-spin"></i>'),$("title").text("#"+hashtag+" | hashtag.info"),$count=0,prepend_posts(new_posts),new_posts=[],t.preventDefault()}),function(){function t(t,e,o){var s=t%10;return s>1&&5>s&&(t>20||10>t)?e:o}jQuery.timeago.settings.strings={prefixAgo:null,prefixFromNow:"za",suffixAgo:"temu",suffixFromNow:null,seconds:"mniej niż minutę",minute:"minutę",minutes:function(e){return t(e,"%d minuty","%d minut")},hour:"godzinę",hours:function(e){return t(e,"%d godziny","%d godzin")},day:"dzień",days:"%d dni",month:"miesiąc",months:function(e){return t(e,"%d miesiące","%d miesięcy")},year:"rok",years:function(e){return t(e,"%d lata","%d lat")}}}(),$(document).ready(function(){});